<html lang="es">
<head>
</head>
<body>
    <canvas id ="webglcanvas" style = "border: none" width="500" height="500"></canvas>
    <script id = "vs" type = "vertex">
        #version 300 es
        uniform mat4 uMatrizProyeccion;
        uniform mat4 uMatrizVista;
        uniform mat4 uMatrizModelo;

        layout (location = 0) in vec2 aVertices; 
        layout (location = 1) in vec4 aColores;

        out vec4 vColores;

        void main() {
            vColores = aColores;
            gl_Position = uMatrizProyeccion * uMatrizVista * uMatrizModelo * vec4(aVertices, 0.0, 1.0);
        }
    </script>
    <script id = "fs" type = "fragment">
        #version 300 es
        precision mediump float;

        in vec4 vColores;
        uniform vec4 uColor;  
        uniform bool uUsarUniforme;  // bandera para elegir
        out vec4 color;

        void main(){
            if (uUsarUniforme) {
                color = uColor;    // usa el uniforme (para grises, negro, etc.)
            } else {
                color = vColores;  // usa colores por vértice (circunferencia)
            }
        }
    </script>

    <script>
        let programaID;
        let gl, canvas;
        let circulo;

        /* Variables Uniformes */
        let uMatrizProyeccion;
        let uMatrizVista;
        let uMatrizModelo;

        /* Matrices */
        let MatrizProyeccion = new Array(16);
        let MatrizVista = new Array(16);
        let MatrizModelo = new Array(16);

        /* Matriz Identidad */
        function identidad(r) {
          r[0] = 1; r[4] = 0; r[ 8] = 0; r[12] = 0;
          r[1] = 0; r[5] = 1; r[ 9] = 0; r[13] = 0;
          r[2] = 0; r[6] = 0; r[10] = 1; r[14] = 0;
          r[3] = 0; r[7] = 0; r[11] = 0; r[15] = 1;
        }

        /* Traslación - glTranslatef */
        function traslacion(matriz, tx, ty, tz) {
          let r = new Array(16);
          r[0] = 1; r[4] = 0; r[ 8] = 0; r[12] = tx;
          r[1] = 0; r[5] = 1; r[ 9] = 0; r[13] = ty;
          r[2] = 0; r[6] = 0; r[10] = 1; r[14] = tz;
          r[3] = 0; r[7] = 0; r[11] = 0; r[15] =  1;
          multiplica(matriz, matriz, r);
        }

        /* Proyección Paralela - glOrtho */
        function ortho(r, izq, der, abj, arr, cerca, lejos) {
          r[0] = 2/(der - izq); r[4] =             0; r[ 8] =                  0; r[12] =         -(der + izq)/(der - izq);
          r[1] =             0; r[5] = 2/(arr - abj); r[ 9] =                  0; r[13] =         -(arr + abj)/(arr - abj);
          r[2] =             0; r[6] =             0; r[10] = -2/(lejos - cerca); r[14] = -(lejos + cerca)/(lejos - cerca);
          r[3] =             0; r[7] =             0; r[11] =                  0; r[15] =                                1;
        }

        function multiplica(c, a, b) {
          let r = new Array(16);
          let i, j, k;
          for (i = 0; i < 4; i++){
            for (j = 0; j < 4; j++){
              let s = 0;
              for (k = 0; k < 4; k++)
                s = s + a[i + k * 4] * b[k + j * 4];
                r[i + j * 4] = s;
              }
            }
          for (i = 0; i < 16; i++)
            c[i] = r[i];
        }

        function circunferencia(radio,r,g,b){

            /* Las coordenadas cartesianas (x, y) */
            let vertices = [];

            /* Los colores x c/vértice (r,g,b,a) */
            let colores = [];

            /* Lee los vértices (x,y) y colores (r,g,b,a) */
            for (let i = 0; i < 360; i++) {
               vertices.push(radio * Math.cos(i * Math.PI / 180)); // x
               vertices.push(radio * Math.sin(i * Math.PI / 180)); // y

               colores.push(r);
               colores.push(g);
               colores.push(b);
               colores.push(1);
            }

            circulo = gl.createVertexArray();
            gl.bindVertexArray(circulo);

            let codigoVertices = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, codigoVertices);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(0);
            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);

            let codigoColores = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, codigoColores);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colores), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(1);
            gl.vertexAttribPointer(1, 4, gl.FLOAT, false, 0, 0);

            gl.bindVertexArray(null);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);


        }
        function crearTriangulosDifuminados(gl) {
            // 2 triángulos = 6 vértices
            let vertices = [
                -0.2, 0.86,
                -0.27, 0.73,
                -0.13, 0.73,

                -0.13, 0.6,
                -0.2,0.73,
                -0.06,0.73,

                -0.16,0.66,
                -0.24,0.53,
                -0.089,0.529,

                -0.28,0.464,
                -0.202,0.592,
                -0.35,0.592,

                -0.354,0.725,
                -0.28,0.595,
                -0.429,0.596,

                -0.316,0.664,
                -0.242,0.792,
                -0.39,0.793
                
            ];

            let colores = [
                1,1,1,1,  
                0,0,0,1,  
                0,0,0,1,  
                1,1,1,1,  
                0,0,0,1,  
                0,0,0,1,
                1,1,1,1,  
                0,0,0,1,  
                0,0,0,1,
                1,1,1,1,  
                0,0,0,1,  
                0,0,0,1,
                1,1,1,1,  
                0,0,0,1,  
                0,0,0,1,
                1,1,1,1,  
                0,0,0,1,  
                0,0,0,1,

            ];

            let vao = gl.createVertexArray();
            gl.bindVertexArray(vao);

            // buffer de vértices
            let vboVertices = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vboVertices);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(0);
            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);

            // buffer de colores
            let vboColores = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vboColores);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colores), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(1);
            gl.vertexAttribPointer(1, 4, gl.FLOAT, false, 0, 0);

            gl.bindVertexArray(null);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);

            return vao;
        }

        function main(){
            canvas = document.getElementById("webglcanvas");
            gl = canvas.getContext("webgl2");

            gl.viewport(0,0,gl.canvas.width,gl.canvas.height);//se usara toda la ventana

            var shaderDeVertice = gl.createShader(gl.VERTEX_SHADER);//sirve para compilar el codigo del shaderDeVertice
            gl.shaderSource(shaderDeVertice,document.getElementById("vs").text.trim());
            gl.compileShader(shaderDeVertice);

            var shaderDeFragmento = gl.createShader(gl.FRAGMENT_SHADER);//sirve para compilar el codigo del shaderDeFragmento
            gl.shaderSource(shaderDeFragmento,document.getElementById("fs").text.trim());
            gl.compileShader(shaderDeFragmento);

            //enlazar ambos
            programaID = gl.createProgram();
            gl.attachShader(programaID,shaderDeVertice); 
            gl.attachShader(programaID,shaderDeFragmento);
            gl.linkProgram(programaID);

            gl.useProgram(programaID);
            gl.clearColor(255/255,255/255,255/255,1); //se da el color al canvas
            gl.clear(gl.COLOR_BUFFER_BIT);

            uMatrizProyeccion = gl.getUniformLocation(programaID, "uMatrizProyeccion");
            uMatrizVista = gl.getUniformLocation(programaID, "uMatrizVista");
            uMatrizModelo = gl.getUniformLocation(programaID, "uMatrizModelo");

             // (izq, der, abj, arr)
            ortho(MatrizProyeccion, -1, 1, -1, 1, -1, 1);
            
            gl.uniformMatrix4fv(uMatrizProyeccion, false, MatrizProyeccion);

            identidad(MatrizVista);
            gl.uniformMatrix4fv(uMatrizVista, false, MatrizVista);

            identidad(MatrizModelo);
            //traslacion(MatrizModelo, 1, 1, 0);
            gl.uniformMatrix4fv(uMatrizModelo, false, MatrizModelo);


            //geometria
            var vertices= [


                //NARIZ
                -0.708713839676, -0.4760009104794,
                -0.6915381831338, -0.5342073020947,
                -0.6209271506824, -0.4831574340387,
                -0.6481219402076, -0.5385012162303,
                -0.5140563988641, -0.4774322151912,
                -0.6094767129876, -0.5728525293147,
                -0.5646291653495, -0.5432722319365,
                -0.5140563988641, -0.4774322151912,
                -0.5049914690224, -0.5327759973829, 
                //OJO
                -0.4126911170474, -0.2246813624963,
                -0.3497752352943, -0.182249721314,
                -0.4104963769863, -0.1456707202948,
                -0.3227067745401, -0.1603023207025,
                -0.3607489356001, -0.0747074583174,
                -0.2634487928889, -0.1639602208044,
                -0.2963698938062, -0.0432495174409,
                -0.2034592312173, -0.1434759802336,
                -0.2634487928889, -0.1639602208044,
                -0.2078487113396, -0.2005392218236,
                -0.307343594112, -0.1895655215178,
                -0.1566381099127, -0.2246813624963,
                -0.2, -0.3,
                -0.3234383545605, -0.3841658069402,
                -0.307343594112, -0.1895655215178,
                -0.4126911170474, -0.2246813624963,
                -0.3497752352943, -0.182249721314,
                //OJO
                -0.6276777066995, -0.1947843692172,//26
                -0.6419236773888, -0.1902856416311,
                -0.6276777066995, -0.072568936462,
                -0.6509211325609, -0.1722907312868,
                -0.6741645584223, -0.1063093933576,
                -0.6756641342844, -0.183537550252,
                -0.6842320977124, -0.1772149408503,
                -0.7043668117682, -0.2046324238199,
                -0.6756641342844, -0.183537550252,
                -0.7103643861678, -0.272747330725,
                -0.6612709495883, -0.2001127897427,
                -0.6963504814445, -0.3136429110228,
                -0.6612709495883, -0.2001127897427,
                -0.6276777066995, -0.1947843692172,
                -0.6419236773888, -0.1902856416311,
                //OREJA
                -0.7129422950255, 0.091079408336, //41
                -0.7734832708512, 0.2264062954758,
                -0.6880136579208, 0.1468720723322,
                -0.7527094065973, 0.3302756167454,
                -0.5609963164825, 0.2246256785397,
                -0.65,0.4,
                -0.5099519643157, 0.3035663627046,
                -0.5823637197151, 0.4204935415052,
                -0.5040165745289, 0.3409593183617,
                //OREJA
                -0.116040258255, 0.2004786226338,//50
                0.0223986893993, 0.2082469580874,
                -0.1296919033896, 0.2358997931399,
                0.0915307770306, 0.3835659323204,
                -0.1158654858633, 0.3874373292277,
                0.0174211790898, 0.4139840508781,

                -0.116040258255, 0.2004786226338, //56
                0.0223986893993, 0.2082469580874,
                -0.116724708153, 0.1870885657292,
                0.0792301383514, 0.1490917810884,
                0.0223986893993, 0.2082469580874,
                0.0915307770306, 0.3835659323204,

                0.0792301383514, 0.1490917810884,//62
                0.0915307770306, 0.3835659323204,
                0.1416534274041,0.1610336276898,
                0.1687939878617, 0.2636249462198,
                0.176936155999,0.2419124978537,
                //BOCA
                -0.693511042846, -0.5783726186382, //67
                -0.5648066408381,-0.5937611884435,
                -0.6804540745263,-0.5909632666607,
                -0.5648066408381,-0.5937611884435,
                -0.5694698438094,-0.6287352107282,
                -0.4752731437891,-0.5653156503185,
                -0.4505581680412,-0.6035539146832,
                -0.4137188645679, -0.5336058701137,

                0.0113165003543,-0.7965314788677,//75
                -0.127704072927,-0.4853149682266,
                0.0681885530603,-0.3383954987361,
                0.2356451526947,-0.4584587211154,
                0.4726120389697,-0.5485061378999,
                0.1771933207468,-0.8628822070248,

                0.1787162649829,-0.0327443221342, //81
                0.2356451526947,-0.4584587211154, 
                0.4726120389697,-0.5485061378999,
                0.4392502932536,-0.3329444308337,
                0.815176555499, 0.0844509154963,
                0.55,0.1,

                0.815176555499, 0.0844509154963,//87
                0.55,0.1,
                0.6133403834365, 0.3474008995293,

                //silueta
                0.0113165003543,-0.7965314788677, //90
                -0.1282487264293,-0.6444380032557,
                -0.25,-0.55,
                -0.4030174328534,-0.6216219721021,
                -0.52454182963,-0.6662418613076,
                -0.6249826123726,-0.6590675196831,
                -0.6381355720175,-0.6052599574995,
                -0.6871602397848,-0.5861283798343,
                -0.7302062895316,-0.522755028818,
                -0.7213906319884,-0.4469331171923,
                -0.7112023684279,-0.3633893559968,
                -0.737691853685, -0.3404657629859,
                -0.74176715910921, -0.244696085518,
                -0.7747437928728,-0.2127484951253,

                -0.7764572693557,-0.0876647118686,
                -0.717289859165,0.0374406208482,
                -0.7122046367685,0.0908354560122,
                -0.6876260618517,0.1459253653084,
                -0.5681740676914,0.2230088185894,
                -0.5089414316859,0.3038539021756,
                -0.5033508321677,0.3411245656303,
                -0.4519173166002, 0.3344158462085,
                -0.3761737456479,0.3716022069471,
                -0.1037831041301,0.4276891940571,
                0.0981856598911,0.5305203136493,
                0.3409288611736,0.552722333801,
                0.6060218794651, 0.4609895093436,
                0.7222955094232, 0.3156599718959,
                0.815176555499, 0.0844509154963,

                -0.127704072927,-0.4853149682266,//119
                0.0113165003543,-0.7965314788677, 
                -0.1282487264293,-0.6444380032557,
                -0.25,-0.55,
                -0.4030174328534,-0.6216219721021,
                -0.4137188645679, -0.5336058701137,
                -0.309126508537, -0.513259020714,
                -0.3234383545605, -0.3841658069402,
                -0.2, -0.3,

                -0.127704072927,-0.4853149682266,
                0.0681885530603,-0.3383954987361,
                -0.1566381099127, -0.2246813624963,

                0.1787162649829,-0.0327443221342,
                0.2356451526947,-0.4584587211154,
                0.0681885530603,-0.3383954987361,
                -0.0435479694904, 0.0228255760531,

                0.55,0.1,
                0.1787162649829,-0.0327443221342,
                0.2274796862328, 0.1290135423195,
                0.2862744164749, 0.1824413111954,
                0.1792743251993, 0.2479700319274,
                0.519502972759, 0.3383295857327,
                0.6133403834365, 0.3474008995293,

                0.6133403834365, 0.3474008995293,
                0.519502972759, 0.3383295857327,
                0.6060218794651, 0.4609895093436,
                0.7222955094232, 0.3156599718959,
                0.815176555499, 0.0844509154963,

                -0.2963698938062, -0.0432495174409,
                -0.2034592312173, -0.1434759802336,
                -0.0435479694904, 0.0228255760531,
                
                -0.55,0,
                -0.6276777066995, -0.1947843692172,
                -0.5118332601426, -0.1790210219039,
                -0.4132581316589, -0.1877655897532,

                -0.6381355720175,-0.6052599574995,
                -0.6249826123726,-0.6590675196831,
                -0.5694698438094,-0.6287352107282,
                -0.52454182963,-0.6662418613076,
                -0.4505581680412,-0.6035539146832,
                -0.4030174328534,-0.6216219721021,
                -0.4137188645679, -0.5336058701137,
                
                -0.5581350675776, -0.2838510285032,
                -0.718747098139, - 0.4477408556068,
                -0.708713839676, -0.4760009104794,
                -0.6209271506824, -0.4831574340387,

                -0.6061983604804, 0.1257424594029,
                -0.7129422950255, 0.091079408336,
                -0.6880136579208, 0.1468720723322,

                -0.3963747985676,0.2750399938409,
                -0.5609963164825, 0.2246256785397,
                -0.5099519643157, 0.3035663627046,

                0.0000120503186,-0.1347701183702,
                

            ];


            //enviando al shardeVertices
            var lineas = gl.createVertexArray();
            gl.bindVertexArray(lineas);

            var codigoVertices = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, codigoVertices);
            gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices), gl.STATIC_DRAW);
            gl.enableVertexAttribArray(0);
            gl.vertexAttribPointer(0,2,gl.FLOAT,false,0,0);


            gl.bindVertexArray(null);
            gl.bindBuffer(gl.ARRAY_BUFFER,null);


            identidad(MatrizModelo);
            traslacion(MatrizModelo, 0, 0, 0);
            gl.uniformMatrix4fv(uMatrizModelo, false, MatrizModelo);

            circunferencia(1, 0, 0, 0); // geometria
            let uUsarUniforme = gl.getUniformLocation(programaID, "uUsarUniforme");
            gl.uniform1i(uUsarUniforme, 0);
            gl.bindVertexArray(circulo);
            gl.drawArrays(gl.TRIANGLE_FAN, 0, 360);
            gl.bindVertexArray(null);

            circunferencia(0.95, 1, 1, 1); // geometria
            gl.uniform1i(uUsarUniforme, 0);
            gl.bindVertexArray(circulo);
            gl.drawArrays(gl.TRIANGLE_FAN, 0, 360);
            gl.bindVertexArray(null);

            let triangulos = crearTriangulosDifuminados(gl);

            gl.uniform1i(uUsarUniforme, 0); // usa colores por vértice
            gl.bindVertexArray(triangulos);
            gl.drawArrays(gl.TRIANGLES, 0, 18);
            gl.bindVertexArray(null);

            var uColor = gl.getUniformLocation(programaID, "uColor");

            gl.bindVertexArray(lineas);

            gl.uniform1i(uUsarUniforme, 1);
            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,0,9);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,9,17);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,26,15);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,41,9);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,50,6);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,56,6);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,62,5);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,67,8);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_FAN,75,6);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLE_FAN,81,6);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.TRIANGLES,87,3);

            gl.uniform4f(uColor,0,0,0,1);
            gl.drawArrays(gl.LINE_STRIP,90,29);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_FAN,119,9);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLES,128,3);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_FAN,131,4);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_FAN,135,7);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_FAN,142,5);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLES,147,3);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_FAN,150,4);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_STRIP,154,7);

            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLE_FAN,161,4);

            
            gl.uniform4f(uColor,0.6,0.6,0.6,1);
            gl.drawArrays(gl.TRIANGLES,165,6);

            gl.bindVertexArray(null);
        }
        window.onload = main;
    </script>
</body>
</html>